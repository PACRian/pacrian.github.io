<!-- _includes/footer.html 添加样式 -->
<script>
  // 在脚本前添加配置对象

document.addEventListener('DOMContentLoaded', function() {
  // 添加语法高亮检测
  function applyVSCodeTheme() {
    document.querySelectorAll('.code-content code').forEach(code => {
      code.innerHTML = code.innerHTML
        .replace(/\b(function|class|let|const|var)\b/g, '<span class="keyword">$1</span>')
        .replace(/(["'])(?:(?=(\\?))\2.)*?\1/g, '<span class="string">$&</span>')
        .replace(/\/\/.*/g, '<span class="comment">$&</span>')
        .replace(/\b(\d+)\b/g, '<span class="number">$1</span>');
    });
  }

  // 修改后的折叠函数
  function toggleCodeBlock(header) {
    const content = header.nextElementSibling;
    const isExpanding = !header.classList.contains('expanded');
    
    header.classList.toggle('expanded');
    content.style.maxHeight = isExpanding 
      ? `${content.scrollHeight + 32}px`  // 添加缓冲空间
      : '0';
    
    // 添加材质效果
    if(isExpanding) {
      content.style.opacity = '1';
      content.style.filter = 'drop-shadow(0 4px 12px rgba(0, 0, 0, 0.5))';
    } else {
      content.style.opacity = '0.9';
      content.style.filter = 'none';
    }
    
    // 应用语法高亮
    if(isExpanding) applyVSCodeTheme();
  }

  // 自动包装代码块
  document.querySelectorAll('pre > code').forEach(function(codeBlock) {
    const pre = codeBlock.parentElement;
    const wrapper = document.createElement('div');
    wrapper.className = 'code-collapse';
    
    const header = document.createElement('div');
    header.className = 'code-header';
    header.innerHTML = `<span>${getCodeLanguage(codeBlock)}</span>`;
    
    const content = document.createElement('div');
    content.className = 'code-content';
    
    wrapper.appendChild(header);
    content.appendChild(pre.cloneNode(true));
    wrapper.appendChild(content);
    
    pre.parentNode.replaceChild(wrapper, pre);

    // 添加材质层
    const overlay = document.createElement('div');
    overlay.style.cssText = `
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(120deg, 
        rgba(255,255,255,0.05) 0%, 
        rgba(0,0,0,0.1) 100%);
      pointer-events: none;
    `;
    wrapper.appendChild(overlay);
    
    // 添加交互
    header.addEventListener('click', function() {
      this.classList.toggle('expanded');
      content.classList.toggle('code-expanded');
      
      // 持久化状态
      const state = this.classList.contains('expanded');
      localStorage.setItem(`codeState_${codeBlock.id}`, state);
    });
    
    // 恢复状态
    const savedState = localStorage.getItem(`codeState_${codeBlock.id}`);
    if (savedState === 'true') {
      header.classList.add('expanded');
      content.classList.add('code-expanded');
    }
  });

  function getCodeLanguage(codeElement) {
    return codeElement.className.match(/language-(\w+)/)?.[1] || 'Code';
  }
});
</script>
