<!-- _includes/footer.html 添加样式 -->

<!-- Add this before the closing </body> tag -->
<script src="{{ '/assets/js/code-folding.js' | relative_url }}"></script>
<script src="{{ '/assets/js/lang-detection.js' | relative_url }}"></script>

<!-- <script>
  // 配置 Prism 自动加载语言
  Prism.plugins.autoloader.languages_path = 
    'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';

  // 自定义文件类型映射
  Prism.plugins.autoloader.language_map = {
    'py': 'python',
    'js': 'javascript',
    'ts': 'typescript',
    'c': 'c',
    'cpp': 'cpp',
    'java': 'java',
    'swift': 'swift',
    'bash': 'bash',
    'sql': 'sql',
    'c++': 'cpp',
  };

document.addEventListener('DOMContentLoaded', function() {
  // 核心执行流程
  function initCodeBlocks() {
    document.querySelectorAll('pre > code').forEach(codeBlock => {
      try {
        // 执行代码块包装
        const wrapper = wrapCodeBlock(codeBlock);
        
        // 添加交互事件
        const header = wrapper.querySelector('.code-header');
        header.addEventListener('click', () => toggleCodeBlock(header));
        
        // 初始化高亮
        Prism.highlightElement(codeBlock);
        
      } catch (error) {
        console.error('代码块初始化失败:', error);
      }
    });

    document.querySelectorAll('.code-collapse').forEach(wrapper => {
      const pre = wrapper.querySelector('pre');
      if (pre) {
        pre.classList.add('language-' + wrapper.dataset.lang);
      }
    });

  }

  // 代码块包装函数
  function wrapCodeBlock(codeBlock) {
    const pre = codeBlock.parentElement;
    const lang = pre.className.match(/language-(\w+)/)?.[1] || 'text';
    
    // 创建容器
    const wrapper = document.createElement('div');
    wrapper.className = 'code-collapse';
    wrapper.dataset.lang = lang;

    // 创建头部
    const header = document.createElement('div');
    header.className = 'code-header';
    header.innerHTML = `
      <span class="lang-tag">${lang.toUpperCase()}</span>
      <span class="copy-btn" title="Copy">⎘</span>
    `;

    // 创建内容区
    const content = document.createElement('div');
    content.className = 'code-content';
    
    // 重组 DOM
    wrapper.appendChild(header);
    content.appendChild(pre.cloneNode(true));
    wrapper.appendChild(content);
    pre.parentNode.replaceChild(wrapper, pre);

    return wrapper;
  }

  // 折叠切换函数
  function toggleCodeBlock(header) {
    const wrapper = header.closest('.code-collapse');
    const content = wrapper.querySelector('.code-content');
    const isExpanding = !wrapper.classList.contains('expanded');

    wrapper.classList.toggle('expanded');
    content.style.maxHeight = isExpanding 
      ? `${content.scrollHeight+32}px` 
      : '0';
    
      // 添加材质效果
    if(isExpanding) {
      content.style.opacity = '1';
      content.style.filter = 'drop-shadow(0 4px 12px rgba(0, 0, 0, 0.5))';
    } else {
      content.style.opacity = '0.5';
      content.style.filter = 'none';
    }
  }

  // 启动初始化
  initCodeBlocks();
  
  // Other scripts...
});

</script> -->
